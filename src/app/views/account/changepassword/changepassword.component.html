<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-xl-6">
      <c-card class="shadow-sm">
        <c-card-header class="bg-primary text-white">
          <div class="d-flex align-items-center justify-content-between">
            <h4 class="mb-0">
              <i class="cil-lock-locked me-2"></i>
              Change Password
            </h4>
            <button 
              type="button" 
              class="btn btn-sm btn-light" 
              (click)="goBack()"
            >
              <i class="cil-arrow-left me-1"></i> Back
            </button>
          </div>
        </c-card-header>

        <c-card-body class="p-4">
          <!-- Info Alert -->
          <div class="alert alert-info d-flex align-items-start mb-4">
            <i class="cil-info me-2"></i>
            <div>
              <strong>Password Requirements:</strong>
              <ul class="mb-0 mt-2 ps-3">
                <li>Minimum 8 characters</li>
                <li>At least one uppercase letter</li>
                <li>At least one lowercase letter</li>
                <li>At least one number</li>
                <li>At least one special character (@$!%*?&)</li>
              </ul>
            </div>
          </div>

          <form [formGroup]="passwordForm" class="form-professional">

            <hr class="my-4" />

            <!-- New Password -->
            <div class="mb-4">
              <label class="form-label">
                <i class="cil-lock me-1"></i> New Password
              </label>
              <div class="password-input-wrapper">
                <input 
                  [type]="showNewPassword ? 'text' : 'password'"
                  class="form-control form-control-custom" 
                  formControlName="newPassword"
                  placeholder="Enter your new password"
                  autocomplete="new-password"
                />
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (click)="showNewPassword = !showNewPassword"
                  tabindex="-1"
                >
                  <i [class]="showNewPassword ? 'cil-eye-slash' : 'cil-eye'"></i>
                </button>
              </div>

              @if (passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched) {
                <div class="text-danger small mt-1">
                  <i class="cil-warning me-1"></i>
                  @if (passwordForm.get('newPassword')?.errors?.['required']) {
                    New password is required
                  }
                  @if (passwordForm.get('newPassword')?.errors?.['minlength']) {
                    Password must be at least 8 characters
                  }
                </div>
              }
            </div>

            <!-- Confirm New Password -->
            <div class="mb-4">
              <label class="form-label">
                <i class="cil-lock me-1"></i> Confirm New Password
              </label>
              <div class="password-input-wrapper">
                <input 
                  [type]="showConfirmPassword ? 'text' : 'password'"
                  class="form-control form-control-custom" 
                  formControlName="confirmPassword"
                  placeholder="Re-enter your new password"
                  autocomplete="new-password"
                />
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (click)="showConfirmPassword = !showConfirmPassword"
                  tabindex="-1"
                >
                  <i [class]="showConfirmPassword ? 'cil-eye-slash' : 'cil-eye'"></i>
                </button>
              </div>
              
              <!-- Password Match Indicator -->
              @if (passwordForm.get('confirmPassword')?.value && passwordForm.get('newPassword')?.value) {
                @if (passwordForm.get('confirmPassword')?.value === passwordForm.get('newPassword')?.value) {
                  <div class="text-success small mt-1">
                    <i class="cil-check-circle me-1"></i>
                    Passwords match
                  </div>
                } @else {
                  <div class="text-danger small mt-1">
                    <i class="cil-warning me-1"></i>
                    Passwords do not match
                  </div>
                }
              }

              @if (passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched) {
                <div class="text-danger small mt-1">
                  <i class="cil-warning me-1"></i>
                  Passwords must match
                </div>
              }
            </div>

            <!-- Action Buttons -->
            <div class="d-flex gap-3 mt-4 pt-3 border-top">
              <button 
                type="button" 
                class="btn btn-secondary flex-fill"
                (click)="resetForm()"
                [disabled]="isSubmitting"
              >
                <i class="cil-reload me-2"></i>
                Reset
              </button>
              <button 
                type="submit" 
                class="btn btn-primary flex-fill"
                (click)="submitPasswordChange()"
                [disabled]="!passwordForm.valid || isSubmitting"
              >
                @if (!isSubmitting) {
                  <span>
                    <i class="cil-check me-2"></i>
                    Change Password
                  </span>
                } @else {
                  <span>
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Updating...
                  </span>
                }
              </button>
            </div>
          </form>
        </c-card-body>
      </c-card>

      <!-- Security Tips Card -->
      <c-card class="shadow-sm mt-4">
        <c-card-header class="bg-light">
          <h5 class="mb-0">
            <i class="cil-shield-alt me-2 text-primary"></i>
            Security Tips
          </h5>
        </c-card-header>
        <c-card-body>
          <ul class="security-tips-list mb-0">
            <li>
              <i class="cil-check-circle text-success me-2"></i>
              Use a unique password that you don't use for other accounts
            </li>
            <li>
              <i class="cil-check-circle text-success me-2"></i>
              Avoid using personal information in your password
            </li>
            <li>
              <i class="cil-check-circle text-success me-2"></i>
              Change your password regularly (every 3-6 months)
            </li>
            <li>
              <i class="cil-check-circle text-success me-2"></i>
              Never share your password with anyone
            </li>
          </ul>
        </c-card-body>
      </c-card>
    </div>
  </div>
</div>

<!-- Success/Error Toast -->
@if (showToast) {
  <div class="toast-container">
    <div class="toast show" role="alert">
      <div 
        class="toast-body" 
        [class.bg-success]="toastType === 'success'"
        [class.bg-danger]="toastType === 'error'"
      >
        <i 
          [class]="toastType === 'success' ? 'cil-check-circle' : 'cil-x-circle'"
          class="me-2"
        ></i>
        {{ toastMessage }}
      </div>
    </div>
  </div>
}