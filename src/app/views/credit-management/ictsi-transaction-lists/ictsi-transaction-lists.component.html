<div class="card my-4 shadow-sm">
    <div class="card-header bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">
                <i class="cil-list me-2"></i> Credit Transactions - {{ ictsiName }}
            </h4>
            <div class="d-flex gap-2">
                <button class="btn btn-light btn-sm" type="button" (click)="goBack()">
                    <i class="cil-arrow-left me-2"></i> Back to Credits
                </button>
                <button class="btn btn-light btn-sm" type="button" (click)="openNewTransactionModal()">
                    <i class="cil-plus me-2"></i> Add Transaction
                </button>
            </div>
        </div>
    </div>

    <div class="card-body">
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="credit-summary-card total">
                    <div class="card-icon">
                        <i class="cil-arrow-top"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Total Credits</div>
                        <div class="card-value">{{ getTotalCredits() | number:'1.2-2' }}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="credit-summary-card remaining">
                    <div class="card-icon">
                        <i class="cil-wallet"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Current Balance</div>
                        <div class="card-value">{{ currentBalance | number:'1.2-2' }}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="credit-summary-card used">
                    <div class="card-icon">
                        <i class="cil-arrow-bottom"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Total Debits</div>
                        <div class="card-value">{{ getTotalDebits() | number:'1.2-2' }}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="credit-summary-card total">
                    <div class="card-icon">
                        <i class="cil-chart-line"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Total Transactions</div>
                        <div class="card-value">{{ transactions.length }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Table -->
        <div class="table-responsive">
            <table class="table table-hover table-custom">
                <thead>
                    <tr>
                        <th>
                            <i class="cil-layers me-2"></i> Transaction Type
                        </th>
                        <th class="text-center">
                            <i class="cil-dollar me-2"></i> Amount
                        </th>
                        <th>
                            <i class="cil-notes me-2"></i> Reference #
                        </th>
                        <th>
                            <i class="cil-notes me-2"></i> Job Reference #
                        </th>
                        <th>
                            <i class="cil-notes me-2"></i> Reimbursable
                        </th>
                        <th class="text-center">
                            <i class="cil-calendar me-2"></i> Transaction Date
                        </th>
                        <th>
                            <i class="cil-user me-2"></i> Created By
                        </th>
                        <th class="text-center">
                            <i class="cil-settings me-2"></i> Actions
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if(getPagedTransactions().length > 0) {
                    @for(transaction of getPagedTransactions(); track transaction.ictsiTransactionId) {
                    <tr [class.inactive-row]="!transaction.isActive">
                        <td class="small">
                            <div class="d-flex align-items-center">
                                @if(isDebitTransaction(transaction.optionIctsiTransactionTypeId)) {
                                <span class="badge bg-danger me-2">
                                    <i class="cil-arrow-bottom"></i>
                                </span>
                                } @else {
                                <span class="badge bg-success me-2">
                                    <i class="cil-arrow-top"></i>
                                </span>
                                }
                                <span>{{ transaction.ictsiTransactionTypeName
                                    }}</span>
                            </div>
                        </td>
                        <td class="text-center">
                            @if(isDebitTransaction(transaction.optionIctsiTransactionTypeId)) {
                            <span class="text-danger fw-bold">-{{ transaction.amount | number:'1.2-2' }}</span>
                            } @else {
                            <span class="text-success fw-bold">+{{ transaction.amount | number:'1.2-2' }}</span>
                            }
                        </td>
                        <td class="text-center small">
                            @if(transaction.referenceNumber) {
                            <span>{{ transaction.referenceNumber }}</span>
                            } @else {
                            <span class="text-muted">-</span>
                            }
                        </td>
                        <td class="text-center small">
                            <span>{{transaction.jobCode}}</span>
                        </td>
                        <td class="text-center small">
                            <span>{{transaction.isReimbursement ? 'Yes' : 'No'}}</span>
                        </td>
                        <td class="text-center small">
                            @if(transaction.createdDate) {
                            {{ transaction.createdDate | date:'MM/dd/yy h:mm a' }}
                            } @else {
                            <span class="text-muted">-</span>
                            }
                        </td>
                        <td class="text-center small">
                            @if(transaction.createdByName) {
                            <span>{{ transaction.createdByName }}</span>
                            } @else {
                            <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-primary-outline" title="View Details"
                                    (click)="viewTransactionDetails(transaction)">
                                    <i class="cil-info"></i>
                                </button>
                                <button class="btn btn-sm btn-warning-outline" title="Edit Transaction"
                                    (click)="openEditTransactionModal(transaction)">
                                    <i class="cil-pencil"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    }
                    } @else {
                    <tr>
                        <td colspan="10" class="text-center text-muted py-4">
                            <i class="cil-search me-2" style="font-size: 2rem;"></i>
                            <div class="mt-2">No transactions found</div>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link" type="button" (click)="previousPage()" [disabled]="currentPage === 1">
                        <i class="cil-arrow-left me-1"></i> Previous
                    </button>
                </li>
                @for(page of getPageNumbers(); track page) {
                <li class="page-item" [class.active]="page === currentPage">
                    <button class="page-link" type="button" (click)="currentPage = page">
                        {{ page }}
                    </button>
                </li>
                }
                <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                    <button class="page-link" type="button" (click)="nextPage()"
                        [disabled]="currentPage === getTotalPages()">
                        Next <i class="cil-arrow-right ms-1"></i>
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</div>

@if (showTransactionModal) {
<div class="modal-backdrop" (click)="closeTransactionModal()"></div>
}
<div class="modal custom-modal" [class.show]="showTransactionModal" [class.d-block]="showTransactionModal" tabindex="-1"
    role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg" (click)="$event.stopPropagation()" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="cil-plus me-2"></i> Add New Transaction
                </h5>
                <button type="button" class="btn-close btn-close-white" (click)="closeTransactionModal()"
                    aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <form [formGroup]="transactionForm" class="form-professional">
                    <!-- Transaction Type and Amount -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">
                                <i class="cil-layers me-1"></i> Transaction Type <span class="text-danger">*</span>
                            </label>
                            <select class="form-select form-control-custom"
                                formControlName="optionIctsiTransactionTypeId">
                                <option value="">Select Type</option>
                                @for(type of transactionTypes; track type.optionId) {
                                <option [value]="type.optionId">{{ type.value }}</option>
                                }
                            </select>
                            @if (transactionForm.get('optionIctsiTransactionTypeId')?.invalid &&
                            transactionForm.get('optionIctsiTransactionTypeId')?.touched) {
                            <div class="text-danger small mt-1">Required</div>
                            }
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">
                                <i class="cil-dollar me-1"></i> Amount <span class="text-danger">*</span>
                            </label>
                            <input type="number" class="form-control form-control-custom" formControlName="amount"
                                placeholder="0.00" min="0.01" step="0.01" />
                            @if (transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched) {
                            <div class="text-danger small mt-1">Required</div>
                            }
                        </div>
                    </div>

                    <!-- Reference Number -->
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="cil-notes me-1"></i> Reference Number
                            </label>
                            <input type="text" class="form-control form-control-custom"
                                formControlName="referenceNumber" placeholder="e.g., INV-2024-001" maxlength="50" />
                        </div>
                    </div>

                    @if (isDebitSelected()) {
                    <div class="optional-section p-2 mb-3 bg-light rounded border">
                        <div class="d-flex align-items-center mb-2">
                            <i class="cil-info text-primary me-2"></i>
                            <small class="text-muted mb-0">Optional: Link to job and mark as reimbursement</small>
                        </div>

                        <!-- Job Code and Reimbursement -->
                        <div class="row g-2">
                            <!-- Job Code Search Field -->
                            <div class="col-md-8">
                                <div class="position-relative jobcode-dropdown">
                                    <label class="form-label small mb-1">
                                        <i class="cil-briefcase me-1"></i> Job Code
                                    </label>
                                    <input type="text" class="form-control form-control-sm"
                                        placeholder="Search job code" [value]="jobCodeSearch"
                                        (input)="onJobCodeSearchChange($any($event.target).value)"
                                        (focus)="jobCodeDropdownOpen = true" />
                                    @if (jobCodeDropdownOpen && filteredJobs.length > 0) {
                                    <ul class="dropdown-list">
                                        @for(job of filteredJobs; track job.jobId){
                                        <li class="dropdown-item-custom" (click)="selectJobCode(job)">
                                            <strong>{{ job.jobCode }}</strong>
                                        </li>
                                        }
                                    </ul>
                                    }
                                    @if (jobCodeDropdownOpen && filteredJobs.length === 0 && jobCodeSearch) {
                                    <ul class="dropdown-list">
                                        <li class="dropdown-item-custom text-muted">No results</li>
                                    </ul>
                                    }
                                    <input type="hidden" formControlName="jobCode" />
                                </div>
                            </div>

                            <div class="col-md-4 d-flex align-items-end">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="isReimbursement"
                                        formControlName="isReimbursement">
                                    <label class="form-check-label small" for="isReimbursement">
                                        <i class="cil-money me-1"></i> Reimbursement
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    }

                    <!-- Notes -->
                    <div class="row mb-2">
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="cil-note-add me-1"></i> Notes
                            </label>
                            <textarea class="form-control form-control-custom" formControlName="notes" rows="2"
                                placeholder="Additional notes..." maxlength="1000"></textarea>
                            <small class="text-muted">
                                {{ transactionForm.get('notes')?.value?.length || 0 }}/1000
                            </small>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary btn-sm" (click)="closeTransactionModal()">
                    <i class="cil-x me-1"></i> Cancel
                </button>
                <button type="button" class="btn btn-primary btn-sm" (click)="submitTransactionForm()"
                    [disabled]="!transactionForm.valid || isSubmitting">
                    @if (!isSubmitting) {
                    <span>
                        <i class="cil-check me-1"></i> Create
                    </span>
                    }
                    @if (isSubmitting) {
                    <span>
                        <span class="spinner-border spinner-border-sm me-1"></span>
                        Saving...
                    </span>
                    }
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Transaction Modal -->
@if (showEditTransactionModal) {
<div class="modal-backdrop" (click)="closeEditTransactionModal()"></div>
}
<div class="modal custom-modal" [class.show]="showEditTransactionModal" [class.d-block]="showEditTransactionModal" tabindex="-1"
    role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg" (click)="$event.stopPropagation()" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">
                    <i class="cil-pencil me-2"></i> Edit Transaction
                </h5>
                <button type="button" class="btn-close" (click)="closeEditTransactionModal()"
                    aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <!-- Information Notice -->
                <div class="alert alert-info d-flex align-items-center mb-3" role="alert">
                    <i class="cil-info me-2"></i>
                    <div>
                        <strong>Note:</strong> Only the transaction amount can be updated. All other information is displayed for reference only.
                    </div>
                </div>

                <form [formGroup]="editTransactionForm" class="form-professional">
                    <!-- Transaction Information Section -->
                    <div class="info-section mb-3">
                        <h6 class="section-title mb-3">
                            <i class="cil-list me-2"></i> Transaction Information
                        </h6>

                        <!-- Transaction Type (Read-only) -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label text-muted small">
                                    <i class="cil-layers me-1"></i> Transaction Type
                                </label>
                                <div class="form-control form-control-custom bg-light" style="border: 1px solid #e0e0e0;">
                                    {{ selectedTransaction?.transactionTypeName || 'N/A' }}
                                </div>
                            </div>

                            <!-- Transaction Date (Read-only) -->
                            <div class="col-md-6">
                                <label class="form-label text-muted small">
                                    <i class="cil-calendar me-1"></i> Transaction Date
                                </label>
                                <div class="form-control form-control-custom bg-light" style="border: 1px solid #e0e0e0;">
                                    {{ selectedTransaction?.createdDate | date:'MM/dd/yy h:mm a' }}
                                </div>
                            </div>
                        </div>

                        <!-- Reference Number (Read-only) -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label class="form-label text-muted small">
                                    <i class="cil-notes me-1"></i> Reference Number
                                </label>
                                <div class="form-control form-control-custom bg-light" style="border: 1px solid #e0e0e0;">
                                    {{ selectedTransaction?.referenceNumber || 'N/A' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Editable Amount Section -->
                    <div class="editable-section mb-3 p-3 bg-warning-subtle rounded border border-warning">
                        <h6 class="section-title mb-3 text-warning">
                            <i class="cil-pencil me-2"></i> Editable Field
                        </h6>
                        
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">
                                    <i class="cil-dollar me-1"></i> Amount <span class="text-danger">*</span>
                                </label>
                                <input type="number" class="form-control form-control-custom" formControlName="amount"
                                    placeholder="0.00" min="0.01" step="0.01" />
                                @if (editTransactionForm.get('amount')?.invalid && editTransactionForm.get('amount')?.touched) {
                                <div class="text-danger small mt-1">Amount is required and must be greater than 0</div>
                                }
                                <small class="text-muted">
                                    Original Amount: <strong>₱{{ selectedTransaction?.amount | number:'1.2-2' }}</strong>
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Job Information (if applicable) -->
                    @if (selectedTransaction?.optionIctsiTransactionTypeId === debitTypeId) {
                    <div class="info-section mb-3">
                        <h6 class="section-title mb-3">
                            <i class="cil-briefcase me-2"></i> Job Information
                        </h6>

                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label text-muted small">
                                    <i class="cil-briefcase me-1"></i> Job Code
                                </label>
                                <div class="form-control form-control-custom bg-light" style="border: 1px solid #e0e0e0;">
                                    {{ selectedTransaction?.jobCode || 'Not linked to any job' }}
                                </div>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label text-muted small">
                                    <i class="cil-money me-1"></i> Reimbursement Status
                                </label>
                                <div class="form-control form-control-custom bg-light d-flex align-items-center" 
                                     style="border: 1px solid #e0e0e0;">
                                    @if (selectedTransaction?.isReimbursement) {
                                    <span class="badge bg-success">
                                        <i class="cil-check me-1"></i> Yes
                                    </span>
                                    } @else {
                                    <span class="badge bg-secondary">
                                        <i class="cil-x me-1"></i> No
                                    </span>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    }

                    <!-- Notes Section -->
                    <div class="info-section mb-2">
                        <h6 class="section-title mb-3">
                            <i class="cil-note-add me-2"></i> Additional Notes
                        </h6>

                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label text-muted small">
                                    <i class="cil-note-add me-1"></i> Notes
                                </label>
                                <div class="form-control form-control-custom bg-light" 
                                     style="border: 1px solid #e0e0e0; min-height: 80px; white-space: pre-wrap;">
                                    {{ selectedTransaction?.notes || 'No notes available' }}
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer py-2">
                <button type="button" class="btn btn-secondary btn-sm" (click)="closeEditTransactionModal()">
                    <i class="cil-x me-1"></i> Cancel
                </button>
                <button type="button" class="btn btn-warning btn-sm" (click)="submitEditTransactionForm()"
                    [disabled]="!editTransactionForm.valid || isSubmitting">
                    @if (!isSubmitting) {
                    <span>
                        <i class="cil-check me-1"></i> Update Amount
                    </span>
                    }
                    @if (isSubmitting) {
                    <span>
                        <span class="spinner-border spinner-border-sm me-1"></span>
                        Updating...
                    </span>
                    }
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Transaction Details Modal -->
@if (showDetailsModal) {
<div class="modal-backdrop" (click)="closeDetailsModal()"></div>
}
<div class="modal custom-modal" [class.show]="showDetailsModal" [class.d-block]="showDetailsModal" tabindex="-1"
    role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg" (click)="$event.stopPropagation()" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="cil-info me-2"></i> Transaction Details
                </h5>
                <button type="button" class="btn-close btn-close-white" (click)="closeDetailsModal()"
                    aria-label="Close"></button>
            </div>

            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                @if(selectedTransaction) {
                
                <!-- Transaction Summary Card -->
                <div class="card mb-3 bg-light border">
                    <div class="card-body py-3">
                        <div class="row g-3 align-items-center">
                            <!-- Amount Display -->
                            <div class="col-md-6 text-center border-end">
                                <small class="text-muted d-block mb-2">Transaction Amount</small>
                                @if(isDebitTransaction(selectedTransaction.optionIctsiTransactionTypeId)) {
                                <div class="display-5 text-danger fw-bold">
                                    <i class="cil-arrow-bottom me-2"></i>₱{{ selectedTransaction.amount | number:'1.2-2' }}
                                </div>
                                <span class="badge bg-danger-subtle text-danger mt-2">Debit</span>
                                } @else {
                                <div class="display-5 text-success fw-bold">
                                    <i class="cil-arrow-top me-2"></i>₱{{ selectedTransaction.amount | number:'1.2-2' }}
                                </div>
                                <span class="badge bg-success-subtle text-success mt-2">Credit</span>
                                }
                            </div>

                            <!-- Transaction Type & Status -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <small class="text-muted d-block">Transaction Type</small>
                                    <span class="badge badge-code-audit">{{ selectedTransaction.transactionTypeName }}</span>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted d-block">Reference Number</small>
                                    <strong class="small">{{ selectedTransaction.referenceNumber || 'N/A' }}</strong>
                                </div>
                                <div>
                                    <small class="text-muted d-block">Transaction Date</small>
                                    <small><i class="cil-calendar me-1"></i>{{ selectedTransaction.createdDate | date: 'MM/dd/yy h:mm a' }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Balance Information -->
                <div class="card mb-3 shadow-sm">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3">
                            <i class="cil-wallet me-2"></i> Balance Information
                        </h6>
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <small class="text-muted d-block">Balance Before</small>
                                        <div class="fw-bold text-primary">₱{{ selectedTransaction.balanceBefore | number:'1.2-2' }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <small class="text-muted d-block">Balance After</small>
                                        <div class="fw-bold text-success">₱{{ selectedTransaction.balanceAfter | number:'1.2-2' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Balance Change Indicator -->
                        <div class="mt-3 pt-3 border-top text-center">
                            <small class="text-muted">Balance Change</small>
                            @if(isDebitTransaction(selectedTransaction.optionIctsiTransactionTypeId)) {
                            <div class="text-danger fw-bold">
                                <i class="cil-arrow-bottom me-1"></i>-₱{{ selectedTransaction.amount | number:'1.2-2' }}
                            </div>
                            } @else {
                            <div class="text-success fw-bold">
                                <i class="cil-arrow-top me-1"></i>+₱{{ selectedTransaction.amount | number:'1.2-2' }}
                            </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Job Information (if applicable) -->
                @if(selectedTransaction.jobCode) {
                <div class="card mb-3 shadow-sm">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3">
                            <i class="cil-briefcase me-2"></i> Job Information
                        </h6>
                        <div class="row g-2">
                            <div class="col-8">
                                <small class="text-muted d-block">Job Code</small>
                                <span class="badge badge-code-audit">{{ selectedTransaction.jobCode }}</span>
                            </div>
                            <div class="col-4">
                                <small class="text-muted d-block">Reimbursement</small>
                                @if(selectedTransaction.isReimbursement) {
                                <span class="badge bg-success">
                                    <i class="cil-check me-1"></i> Yes
                                </span>
                                } @else {
                                <span class="badge bg-secondary">
                                    <i class="cil-x me-1"></i> No
                                </span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                }

                <!-- Notes Section -->
                @if(selectedTransaction.notes) {
                <div class="card mb-3 shadow-sm">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-2">
                            <i class="cil-note-add me-2"></i> Notes
                        </h6>
                        <div class="alert alert-light mb-0 p-2 small">
                            <i class="cil-chat-left-quote me-1"></i>
                            {{ selectedTransaction.notes }}
                        </div>
                    </div>
                </div>
                }

                <!-- Audit Trail -->
                <div class="card shadow-sm">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3">
                            <i class="cil-history me-2"></i> Audit Trail
                        </h6>
                        
                        <!-- Created Info -->
                        <div class="d-flex justify-content-between align-items-start mb-2 pb-2 border-bottom">
                            <div>
                                <small class="text-muted d-block">Created by</small>
                                <div class="small fw-bold">{{ selectedTransaction.createdByName || 'Unknown' }}</div>
                            </div>
                            <div class="text-end">
                                <small class="text-muted d-block">Date & Time</small>
                                <small class="fw-medium">
                                    <i class="cil-clock me-1"></i>{{ selectedTransaction.createdDate | date: 'MM/dd/yy h:mm a' }}
                                </small>
                            </div>
                        </div>

                        <!-- Modified Info -->
                        @if(selectedTransaction.modifiedByName && selectedTransaction.modifiedDate) {
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <small class="text-muted d-block">Last modified by</small>
                                <div class="small fw-bold">{{ selectedTransaction.modifiedByName }}</div>
                            </div>
                            <div class="text-end">
                                <small class="text-muted d-block">Date & Time</small>
                                <small class="fw-medium">
                                    <i class="cil-clock me-1"></i>{{ selectedTransaction.modifiedDate | date: 'MM/dd/yy h:mm a' }}
                                </small>
                            </div>
                        </div>
                        } @else {
                        <div class="text-center text-muted small">
                            <i class="cil-info me-1"></i> No modifications made
                        </div>
                        }
                    </div>
                </div>

                }
            </div>

            <div class="modal-footer py-2">
                <button type="button" class="btn btn-sm btn-secondary" (click)="closeDetailsModal()">
                    <i class="cil-x me-1"></i> Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <!-- Success Toast -->
    <div class="toast align-items-center border-0" [class.show]="showSuccessToast" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body bg-success text-white rounded">
                <div class="d-flex align-items-center">
                    <i class="cil-check-circle me-2" style="font-size: 1.5rem;"></i>
                    <div>
                        <strong class="d-block">Success!</strong>
                        <span>{{ successMessage }}</span>
                    </div>
                </div>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="showSuccessToast = false"
                aria-label="Close"></button>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="toast align-items-center border-0" [class.show]="showErrorToast" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body bg-danger text-white rounded">
                <div class="d-flex align-items-center">
                    <i class="cil-x-circle me-2" style="font-size: 1.5rem;"></i>
                    <div>
                        <strong class="d-block">Error</strong>
                        <span>{{ errorMessage }}</span>
                    </div>
                </div>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="showErrorToast = false"
                aria-label="Close"></button>
        </div>
    </div>
</div>